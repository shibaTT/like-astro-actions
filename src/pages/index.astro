---
import Layout from "../layouts/Layout.astro"
import BlogCard from "../components/BlogCard.astro"
import { getBlogs } from "../lib/microcms"
import { PER_PAGE } from "../lib/constants"

let blogs = []
let totalPages = 1

try {
    const currentPage = Number(Astro.url.searchParams.get("page")) || 1
    const response = await getBlogs({
        limit: PER_PAGE,
        offset: (currentPage - 1) * PER_PAGE,
    })

    blogs = response.contents
    totalPages = Math.ceil(response.totalCount / PER_PAGE)
} catch (error) {
    console.error("Error fetching blogs:", error)
    return Astro.redirect("/error")
}
---

<Layout title="ブログ一覧">
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {blogs.map((blog) => <BlogCard blog={blog} />)}
    </div>
</Layout>
